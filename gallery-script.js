// Photo galleries
const galleries = {
    "sf": [
        "photos/sf/_SCF4026.JPG",
        "photos/sf/_SCF3402.JPG",
        "photos/sf/_SCF3833.JPG",
        "photos/sf/_SCF4033.JPG",
        "photos/sf/_SCF3574.JPG",
        "photos/sf/_SCF4025.JPG",
        "photos/sf/_SCF4019.JPG",
        "photos/sf/_SCF3831.JPG",
        "photos/sf/_SCF3428.JPG",
        "photos/sf/_SCF3818.JPG",
        "photos/sf/_SCF4030.JPG",
        "photos/sf/_SCF4024.JPG",
        "photos/sf/_SCF3575.JPG",
        "photos/sf/_SCF4008.JPG",
        "photos/sf/_SCF4020.JPG",
        "photos/sf/_SCF3820.JPG",
        "photos/sf/_SCF3377.JPG",
        "photos/sf/_SCF3410.JPG",
        "photos/sf/_SCF3389.JPG",
        "photos/sf/_SCF3957.JPG",
        "photos/sf/_SCF3837.JPG",
        "photos/sf/_SCF3407.JPG",
        "photos/sf/_SCF3836.JPG",
        "photos/sf/_SCF3573.JPG",
        "photos/sf/_SCF3528.JPG",
        "photos/sf/_SCF3500.JPG",
        "photos/sf/_SCF3514.JPG",
        "photos/sf/_SCF3925.JPG",
        "photos/sf/_SCF3919.JPG",
        "photos/sf/_SCF3878.JPG",
        "photos/sf/_SCF3717.JPG",
        "photos/sf/_SCF3517.JPG",
        "photos/sf/_SCF3503.JPG",
        "photos/sf/_SCF3926.JPG",
        "photos/sf/_SCF3852.JPG",
        "photos/sf/_SCF3338.JPG",
        "photos/sf/_SCF3506.JPG",
        "photos/sf/_SCF3738.JPG",
        "photos/sf/_SCF3881.JPG",
        "photos/sf/_SCF3922.JPG",
        "photos/sf/_SCF3507.JPG",
        "photos/sf/_SCF3539.JPG",
        "photos/sf/_SCF3854.JPG",
        "photos/sf/_SCF3882.JPG",
        "photos/sf/_SCF3672.JPG",
        "photos/sf/_SCF3538.JPG",
        "photos/sf/_SCF3521.JPG",
        "photos/sf/_SCF3910.JPG",
        "photos/sf/_SCF3870.JPG",
        "photos/sf/_SCF3858.JPG",
        "photos/sf/_SCF3497.JPG",
        "photos/sf/_SCF3871.JPG",
        "photos/sf/_SCF3905.JPG",
        "photos/sf/_SCF3520.JPG",
        "photos/sf/_SCF3508.JPG",
        "photos/sf/_SCF3873.JPG",
        "photos/sf/_SCF3324.JPG",
        "photos/sf/_SCF3457.JPG",
        "photos/sf/_SCF3494.JPG",
        "photos/sf/_SCF3669.JPG",
        "photos/sf/_SCF3682.JPG",
        "photos/sf/_SCF3735.JPG",
        "photos/sf/_SCF3912.JPG",
        "photos/sf/_SCF3523.JPG",
        "photos/sf/_SCF3537.JPG",
        "photos/sf/_SCF3533.JPG",
        "photos/sf/_SCF3916.JPG",
        "photos/sf/_SCF3719.JPG",
        "photos/sf/_SCF3321.JPG",
        "photos/sf/_SCF3320.JPG",
        "photos/sf/_SCF3524.JPG",
        "photos/sf/_SCF3915.JPG",
        "photos/sf/_SCF3849.JPG",
        "photos/sf/_SCF3323.JPG",
        "photos/sf/_SCF3928.JPG",
        "photos/sf/_SCF4013.JPG",
        "photos/sf/_SCF4007.JPG",
        "photos/sf/_SCF3740.JPG",
        "photos/sf/_SCF3387.JPG",
        "photos/sf/_SCF3378.JPG",
        "photos/sf/_SCF3344.JPG",
        "photos/sf/_SCF3345.JPG",
        "photos/sf/_SCF3379.JPG",
        "photos/sf/_SCF3386.JPG",
        "photos/sf/_SCF3582.JPG",
        "photos/sf/_SCF3970.JPG",
        "photos/sf/_SCF3780.JPG",
        "photos/sf/_SCF3409.JPG",
        "photos/sf/_SCF3408.JPG",
        "photos/sf/_SCF3391.JPG",
        "photos/sf/_SCF3587.JPG",
        "photos/sf/_SCF3961.JPG",
        "photos/sf/_SCF3342.JPG",
        "photos/sf/_SCF3343.JPG",
        "photos/sf/_SCF3790.JPG",
        "photos/sf/_SCF3586.JPG",
        "photos/sf/_SCF3340.JPG",
        "photos/sf/_SCF3546.JPG"
    ],

    "seattle": [
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (19).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (8).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (22).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (20).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (18).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (21).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (9).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (23).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (12).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (5).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (7).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (10).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (14).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (3).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (1).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (16).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (6).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (11).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (13).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.53 (1).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (4).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (17).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (15).jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54.jpeg",
        "photos/seattle/WhatsApp Image 2025-09-25 at 13.13.54 (2).jpeg"
        ],


    "palos-verdes": [
        "photos/palos verdes/DSCF3138.JPG",
        "photos/palos verdes/DSCF3229.JPG",
        "photos/palos verdes/DSCF3294 copy.JPG",
        "photos/palos verdes/DSCF3163.JPG",
        "photos/palos verdes/DSCF3167.JPG",
        "photos/palos verdes/DSCF3172.JPG",
        "photos/palos verdes/DSCF3168.JPG",
        "photos/palos verdes/DSCF3182.JPG",
        "photos/palos verdes/DSCF3141.JPG",
        "photos/palos verdes/DSCF3194.JPG",
        "photos/palos verdes/DSCF3181.JPG",
        "photos/palos verdes/DSCF3146.JPG",
        "photos/palos verdes/DSCF3185.JPG",
        "photos/palos verdes/DSCF3233.JPG",
        "photos/palos verdes/DSCF3137.JPG",
        "photos/palos verdes/DSCF3136.JPG"
    ]
};

let currentGallery = [];
let currentImageIndex = 0;

// Gallery functions
function openGallery(location) {
    if (galleries[location] && galleries[location].length > 0) {
        currentGallery = galleries[location];
        showPhotoGrid(location);
    } else {
        alert(`${location.charAt(0).toUpperCase() + location.slice(1).replace('-', ' ')} gallery coming soon!`);
    }
}

function showPhotoGrid(location) {
    const modal = document.getElementById('gallery-modal');
    const modalContent = modal.querySelector('.modal-content');
    // ensure we are not in viewer mode
    modalContent.classList.remove('viewer-mode');
    
    // Clear existing content
    modalContent.innerHTML = '';
    
    // Create header with close button and title
    const header = document.createElement('div');
    header.className = 'grid-header';
    header.innerHTML = `
        <h3 class="grid-title">${location.charAt(0).toUpperCase() + location.slice(1).replace('-', ' ')} Gallery</h3>
        <span class="close">&times;</span>
    `;
    modalContent.appendChild(header);
    
    // Create photo grid container
    const gridContainer = document.createElement('div');
    gridContainer.className = 'photo-grid';
    
    // Add photos to grid (use thumbnails when available, fallback to full image)
    currentGallery.forEach((photo, index) => {
        const gridItem = document.createElement('div');
        gridItem.className = 'grid-item';

        // compute thumbnail path: photos/<gallery>/thumbs/<basename>_thumb.jpg
        const thumbMatch = photo.match(/^(photos\/[^\/]+)\/(.+)\.(jpg|jpeg|png|gif|webp|JPG|JPEG|PNG|GIF|WEBP)$/);
        const thumb = thumbMatch ? `${thumbMatch[1]}/thumbs/${thumbMatch[2]}_thumb.jpg` : photo;

        // Use thumbnail as src and fall back to full image if thumbnail 404s
        gridItem.innerHTML = `<img src="${thumb}" alt="Photo ${index + 1}" loading="lazy" onerror="this.onerror=null;this.src='${photo}';">`;
        gridItem.onclick = () => openImageViewer(index);
        gridContainer.appendChild(gridItem);
    });
    
    modalContent.appendChild(gridContainer);
    modal.style.display = 'block';
    
    // Add event listener for close button
    const closeBtn = modalContent.querySelector('.close');
    closeBtn.onclick = () => {
    modal.style.display = 'none';
    modalContent.classList.remove('viewer-mode');
    };
}

function openImageViewer(startIndex) {
    currentImageIndex = startIndex;
    const modal = document.getElementById('gallery-modal');
    const modalContent = modal.querySelector('.modal-content');
    // switch to viewer mode to center the image
    modalContent.classList.add('viewer-mode');
    
    // Clear grid content and show image viewer
    modalContent.innerHTML = `
        <span class="close">&times;</span>
        <button class="back-to-grid">‚Üê Back to Grid</button>
        <img id="modal-image" src="${currentGallery[currentImageIndex]}" alt="">
        <button class="nav-btn prev-btn">&#8249;</button>
        <button class="nav-btn next-btn">&#8250;</button>
        <div class="image-counter">
            <span id="current-image">${currentImageIndex + 1}</span> / <span id="total-images">${currentGallery.length}</span>
        </div>
    `;
    
    // Add event listeners
    const closeBtn = modalContent.querySelector('.close');
    const backBtn = modalContent.querySelector('.back-to-grid');
    const nextBtn = modalContent.querySelector('.next-btn');
    const prevBtn = modalContent.querySelector('.prev-btn');
    
    closeBtn.onclick = () => {
        modal.style.display = 'none';
    };
    
    backBtn.onclick = () => {
        // Get the current gallery location from the current gallery array
        const location = Object.keys(galleries).find(key => galleries[key] === currentGallery);
        showPhotoGrid(location);
    };
    
    nextBtn.onclick = nextImage;
    prevBtn.onclick = prevImage;
}

function showImage() {
    const modalImage = document.getElementById('modal-image');
    const currentImageSpan = document.getElementById('current-image');
    const totalImagesSpan = document.getElementById('total-images');
    
    if (modalImage) {
        modalImage.src = currentGallery[currentImageIndex];
    }
    if (currentImageSpan) {
        currentImageSpan.textContent = currentImageIndex + 1;
    }
    if (totalImagesSpan) {
        totalImagesSpan.textContent = currentGallery.length;
    }
}

function nextImage() {
    currentImageIndex = (currentImageIndex + 1) % currentGallery.length;
    showImage();
}

function prevImage() {
    currentImageIndex = (currentImageIndex - 1 + currentGallery.length) % currentGallery.length;
    showImage();
}

// Initialize event listeners when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('gallery-modal');

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (modal && modal.style.display === 'block') {
            const modalContent = modal.querySelector('.modal-content');
            const isImageViewer = modalContent.querySelector('#modal-image');
            const isPhotoGrid = modalContent.querySelector('.photo-grid');
            
            if (isImageViewer) {
                // Image viewer keyboard controls
                if (e.key === 'ArrowRight') nextImage();
                if (e.key === 'ArrowLeft') prevImage();
                if (e.key === 'Escape') modal.style.display = 'none';
                if (e.key === 'Backspace' || e.key === 'b' || e.key === 'B') {
                    e.preventDefault();
                    const location = Object.keys(galleries).find(key => galleries[key] === currentGallery);
                    showPhotoGrid(location);
                }
            } else if (isPhotoGrid) {
                // Photo grid keyboard controls
                if (e.key === 'Escape') modal.style.display = 'none';
            }
        }
    });

    // Close modal when clicking outside the content
    if (modal) {
        modal.onclick = (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
                const modalContent = modal.querySelector('.modal-content');
                if (modalContent) modalContent.classList.remove('viewer-mode');
            }
        }
    }

    // Add CSS styles for the new elements
    const style = document.createElement('style');
    style.textContent = `
        .grid-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0 10px 0;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }
        
        .grid-title {
            margin: 0;
            font-size: 1.5em;
            color: #333;
        }
        
        .photo-grid {
            display: grid;
            /* Use ~3 columns on desktop by making each column at least 240px */
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 15px;
            max-height: 70vh;
            overflow-y: auto;
            padding: 10px;
            width: 100%; /* ensure grid spans full modal width so columns can form */
        }

        /* Make the grid header and title white when displayed in the modal */
        .modal-content .grid-header,
        .modal-content .grid-title {
            color: white;
        }
        
        .grid-item {
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            background: #f5f5f5;
        }
        
        .grid-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.2s ease;
        }
        
        .grid-item img:hover {
            opacity: 0.9;
        }

        /* Viewer mode centers the image and fixes its position */
        .modal-content.viewer-mode {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
        }

        .modal-content.viewer-mode #modal-image {
            max-width: 90%;
            max-height: 85vh;
            object-fit: contain;
            display: block;
            margin: 0 auto;
        }
        
        .back-to-grid {
            position: absolute;
            top: 60px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease;
            z-index: 1001;
        }
        
        .back-to-grid:hover {
            background: rgba(0,0,0,0.9);
        }
        
        @media (max-width: 1024px) {
            .photo-grid {
                /* ~2 columns on tablet */
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 12px;
            }
        }

        @media (max-width: 768px) {
            .photo-grid {
                /* single column on small screens */
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }
            
            .grid-header {
                padding: 15px 0 8px 0;
            }
            
            .grid-title {
                font-size: 1.2em;
            }
            
            .back-to-grid {
                top: 50px;
                left: 10px;
                padding: 8px 12px;
                font-size: 12px;
            }
        }
    `;
    document.head.appendChild(style);
});